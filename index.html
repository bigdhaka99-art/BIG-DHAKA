--- START OF FILE index.html ---

<!-- START OF FILE big_dhaka_bd_theme_updated_v4_synced.html -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BIG DHAKA - BD Style</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bdgreen: '#006a4e', // Bangladesh Flag Green
                        bdred: '#f42a41',   // Bangladesh Flag Red
                        bdgold: '#fbbf24',
                    }
                }
            }
        }
    </script>
    <style>
        :root {
            --glass-bg: rgba(255, 255, 255, 0.85);
            --glass-border: rgba(0, 106, 78, 0.1);
            --shadow-3d: 0 20px 40px rgba(0, 106, 78, 0.1), inset 0 2px 5px rgba(255, 255, 255, 0.5);
        }

        body {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); /* Light Greenish Bg */
            font-family: 'Segoe UI', Roboto, sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* --- LOADER STYLES START --- */
        .loader-container {
            position: fixed;
            inset: 0;
            z-index: 9999;
            background: #ecfdf5;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.6s ease-out, visibility 0.6s;
        }
        
        .cube-wrapper {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        @keyframes fillBar {
            0% { width: 0%; }
            50% { width: 60%; }
            100% { width: 100%; }
        }

        .loading-bar-fill {
            animation: fillBar 2.5s ease-in-out forwards;
        }
        /* --- LOADER STYLES END --- */

        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            border-radius: 30px;
            box-shadow: var(--shadow-3d);
        }

        .btn-3d {
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 8px 0 #064e3b, 0 15px 20px rgba(0,0,0,0.1); /* Dark Green Shadow */
            position: relative;
            top: 0;
        }
        .btn-3d:active {
            top: 4px;
            box-shadow: 0 4px 0 #064e3b;
            transform: scale(0.98);
        }

        .btn-green-3d { box-shadow: 0 8px 0 #064e3b; background: linear-gradient(180deg, #006a4e, #047857); }
        .btn-red-3d { box-shadow: 0 8px 0 #991b1b; background: linear-gradient(180deg, #f42a41, #dc2626); }
        .btn-violet-3d { box-shadow: 0 8px 0 #5b21b6; background: linear-gradient(180deg, #8b5cf6, #7c3aed); }

        /* Aviator Button States */
        .btn-aviator-bet { box-shadow: 0 8px 0 #064e3b; background: linear-gradient(180deg, #006a4e, #047857); }
        .btn-aviator-cashout { box-shadow: 0 8px 0 #d97706; background: linear-gradient(180deg, #fbbf24, #d97706); }
        .btn-aviator-waiting { box-shadow: 0 8px 0 #475569; background: linear-gradient(180deg, #94a3b8, #64748b); }

        .premium-card {
            background: linear-gradient(135deg, #006a4e 0%, #022c22 100%); /* BD Green Gradient */
            color: white;
            border-radius: 35px;
            padding: 30px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 106, 78, 0.5);
            border: 2px solid #22c55e;
        }
        
        /* Watermark Circle on Cards */
        .premium-card::after {
            content: '';
            position: absolute;
            top: -50px;
            right: -50px;
            width: 150px;
            height: 150px;
            background: #f42a41;
            border-radius: 50%;
            opacity: 0.2;
            filter: blur(40px);
        }

        .page { display: none; padding-bottom: 110px; }
        .page.active { display: block; animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .nav-btn { color: #64748b; transition: all 0.3s; }
        .nav-btn.active { color: #006a4e; transform: translateY(-5px); } /* BD Green Active */
        .nav-btn.active i { background: #dcfce7; padding: 10px; border-radius: 50%; color: #006a4e; box-shadow: 0 5px 15px rgba(0,106,78,0.2); }

        .market-tab { border-radius: 15px; transition: all 0.3s; font-weight: 900; }
        .market-tab.active { background: #006a4e; color: white; box-shadow: 0 10px 15px rgba(0,106,78,0.3); }

        /* Aviator Animation */
        @keyframes planeFly {
            0% { transform: translate(0, 0); }
            50% { transform: translate(10px, -10px); }
            100% { transform: translate(0, 0); }
        }
        .plane-icon { animation: planeFly 2s infinite ease-in-out; }

        .aviator-canvas-container {
            background: #022c22; /* Dark Green/Black */
            position: relative;
            border-radius: 20px;
            overflow: hidden;
            height: 250px;
            border-bottom: 4px solid #064e3b;
        }
        .fly-line {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0%;
            height: 0%;
            border-top: 2px solid #f42a41;
            border-right: 2px solid #f42a41;
            background: linear-gradient(to bottom right, transparent 50%, rgba(244, 42, 65, 0.2) 100%);
            transition: all 0.1s linear;
        }

        .account-menu-item {
            background: white;
            padding: 16px 20px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
            transition: all 0.2s;
            border: 1px solid #f0fdf4;
            cursor: pointer;
        }
        .account-menu-item:active { transform: scale(0.97); background: #f0fdf4; }

        .auth-input {
            width: 100%;
            padding: 16px;
            border-radius: 15px;
            border: 1px solid #bbf7d0;
            background: #f0fdf4;
            outline: none;
            transition: all 0.3s;
            font-weight: 600;
            color: #064e3b;
        }
        .auth-input:focus { border-color: #006a4e; box-shadow: 0 0 0 4px rgba(0, 106, 78, 0.1); background: white; }

        /* Custom animation for result overlay */
        @keyframes slideInUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .result-overlay-animate {
            animation: slideInUp 0.3s ease-out;
        }

        /* Result Overlay Styles */
        #resultOverlay {
            background-color: rgba(0, 44, 34, 0.6); /* Dark Green Tint */
        }

        /* Marquee styles */
        .marquee-container {
            background-color: #f0fdf4; /* Light Green */
            padding: 8px 0; 
            overflow: hidden; 
            white-space: nowrap; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); 
            border-bottom: 1px solid #bbf7d0;
        }

        .marquee-content {
            display: inline-block;
            animation: marquee 15s linear infinite;
            color: #006a4e; /* BD Green Text */
            font-weight: bold;
            font-size: 0.875rem; 
            padding-left: 100%;
        }

        @keyframes marquee {
            0% { transform: translateX(0%); }
            100% { transform: translateX(-100%); }
        }
    </style>
</head>
<body class="max-w-md mx-auto shadow-2xl bg-green-50 min-h-screen relative">

    <!-- ============================================== -->
    <!-- NEW: BEAUTIFUL INITIAL LOADING SCREEN (BD THEME) -->
    <!-- ============================================== -->
    <div id="app-loader" class="loader-container">
        <!-- Glowing Background Blur -->
        <div class="absolute w-64 h-64 bg-green-500 rounded-full blur-[80px] opacity-20 animate-pulse"></div>
        <div class="absolute w-32 h-32 bg-red-500 rounded-full blur-[60px] opacity-20 animate-pulse top-1/4"></div>
        
        <!-- Logo Section -->
        <div class="cube-wrapper relative z-10 mb-8">
            <div class="w-24 h-24 bg-gradient-to-tr from-bdgreen to-green-700 rounded-full flex items-center justify-center text-white shadow-2xl shadow-green-500/50 border-4 border-bdred">
                <i class="fas fa-coins text-5xl"></i>
            </div>
            <!-- Reflection -->
            <div class="w-24 h-4 bg-black/20 blur-md rounded-full mt-8 mx-auto"></div>
        </div>

        <!-- Text -->
        <h1 class="text-4xl font-black text-slate-800 italic tracking-tighter mb-2 z-10">
            <span class="text-bdred">BIG</span><span class="text-bdgreen">DHAKA</span>
        </h1>
        <p class="text-slate-400 font-bold text-xs uppercase tracking-[0.3em] mb-10 z-10">Trusted BD Platform</p>

        <!-- Progress Bar -->
        <div class="w-48 h-2 bg-green-200 rounded-full overflow-hidden relative z-10">
            <div class="h-full bg-gradient-to-r from-bdgreen to-bdred rounded-full loading-bar-fill"></div>
        </div>
        
        <p class="mt-4 text-[10px] text-green-700 font-bold animate-pulse">Connecting to Server...</p>
    </div>

    <!-- AUTHENTICATION PAGE (LOGIN/SIGNUP) -->
    <div id="auth-page" class="fixed inset-0 z-[5000] bg-green-50 flex flex-col items-center justify-center p-6 transition-all duration-300 hidden">
        <div class="w-20 h-20 bg-bdgreen rounded-full flex items-center justify-center text-white shadow-2xl shadow-green-500/50 mb-6 border-4 border-bdred">
            <i class="fas fa-coins text-3xl"></i>
        </div>
        <h1 class="text-3xl font-black text-slate-800 italic tracking-tighter mb-2"><span class="text-bdred">BIG</span><span class="text-bdgreen">DHAKA</span></h1>
        <p class="text-slate-500 font-bold text-xs uppercase tracking-widest mb-10">‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶¶ ‡¶ü‡ßç‡¶∞‡ßá‡¶°‡¶ø‡¶Ç ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ü‡¶´‡¶∞‡ßç‡¶Æ</p>

        <div class="glass-card w-full p-8 relative overflow-hidden max-h-[90vh] overflow-y-auto border-t-4 border-bdgreen">
            <div class="flex gap-2 mb-8 bg-green-100 p-1 rounded-2xl">
                <button onclick="toggleAuth('login')" id="tab-login" class="flex-1 py-3 rounded-xl text-xs font-black uppercase transition-all bg-white shadow-md text-bdgreen">‡¶≤‡¶ó‡¶ø‡¶®</button>
                <button onclick="toggleAuth('signup')" id="tab-signup" class="flex-1 py-3 rounded-xl text-xs font-black uppercase transition-all text-slate-400 hover:bg-white/50">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞</button>
            </div>

            <!-- Login Form -->
            <div id="form-login" class="space-y-4">
                <div>
                    <label class="text-[10px] font-black uppercase text-slate-500 ml-2">Email / Phone</label>
                    <input type="email" id="login-email" class="auth-input" placeholder="user@example.com">
                </div>
                <div>
                    <label class="text-[10px] font-black uppercase text-slate-500 ml-2">Password</label>
                    <input type="password" id="login-pass" class="auth-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <button onclick="handleLogin()" class="w-full btn-3d btn-green-3d text-white py-4 rounded-2xl font-black uppercase mt-4">Login Now</button>
            </div>

            <!-- Signup Form -->
            <div id="form-signup" class="space-y-3 hidden">
                <div>
                    <label class="text-[10px] font-black uppercase text-slate-500 ml-2">Email</label>
                    <input type="email" id="reg-email" class="auth-input" placeholder="user@example.com">
                </div>
                <div>
                    <label class="text-[10px] font-black uppercase text-slate-500 ml-2">Phone Number</label>
                    <input type="number" id="reg-phone" class="auth-input" placeholder="017xxxxxxxx">
                </div>
                <div>
                    <label class="text-[10px] font-black uppercase text-slate-500 ml-2">Country</label>
                    <select id="reg-country" class="auth-input">
                        <option value="Bangladesh">Bangladesh</option>
                        <option value="India">India</option>
                        <option value="Dubai">Dubai</option>
                    </select>
                </div>
                <div>
                    <label class="text-[10px] font-black uppercase text-slate-500 ml-2">Referral Code (Optional)</label>
                    <input type="text" id="reg-ref" class="auth-input" placeholder="Promo Code">
                </div>
                <div>
                    <label class="text-[10px] font-black uppercase text-slate-500 ml-2">Password</label>
                    <input type="password" id="reg-pass" class="auth-input" placeholder="Min 6 chars">
                </div>
                 <div>
                    <label class="text-[10px] font-black uppercase text-slate-500 ml-2">Confirm Password</label>
                    <input type="password" id="reg-pass-confirm" class="auth-input" placeholder="Confirm">
                </div>
                <div class="flex items-center gap-2 mt-2 ml-1">
                    <input type="checkbox" id="reg-terms" class="w-4 h-4 rounded text-bdgreen focus:ring-green-500 border-gray-300">
                    <label for="reg-terms" class="text-[10px] font-bold text-slate-500 uppercase">I agree to Terms & Conditions</label>
                </div>
                <button onclick="handleRegister()" class="w-full btn-3d bg-slate-800 text-white py-4 rounded-2xl font-black uppercase mt-2">Create Account</button>
            </div>
            <p id="auth-error" class="text-bdred text-center text-xs font-bold mt-4 min-h-[20px]"></p>
        </div>
    </div>

    <!-- MAIN APPLICATION (Initially Hidden) -->
    <div id="main-app" class="relative h-screen overflow-y-auto hidden">

        <!-- Result Overlay -->
        <div id="resultOverlay" class="fixed inset-0 bg-black/80 backdrop-blur-md z-[1000] hidden items-center justify-center p-6">
            <div id="resultBox" class="glass-card p-10 text-center w-full max-w-sm border-t-8 border-bdgreen result-overlay-animate">
                <div id="resIcon" class="text-7xl mb-4 drop-shadow-lg">üèÜ</div>
                <h1 id="resStatus" class="text-5xl font-black italic mb-2">WIN</h1>
                <p id="resAmount" class="text-gray-500 font-bold mb-8 text-xl">You won ‡ß≥0.00</p>
                <button id="resBtn" onclick="closeResult()" class="w-full btn-3d btn-green-3d text-white py-4 rounded-2xl font-black text-lg">COLLECT</button>
            </div>
        </div>

        <!-- 0. HOME PAGE -->
        <div id="page-home" class="page active">
            <!-- Header -->
            <div class="p-6 flex justify-between items-center bg-white sticky top-0 z-50 shadow-sm rounded-b-3xl">
                <div class="flex items-center gap-2">
                    <div class="w-10 h-10 bg-bdgreen rounded-full flex items-center justify-center text-white shadow-lg shadow-green-500/50 border-2 border-bdred">
                        <i class="fas fa-coins text-sm"></i>
                    </div>
                    <div>
                        <h2 class="text-xl font-black text-slate-800 italic tracking-tighter"><span class="text-bdred">BIG</span><span class="text-bdgreen">DHAKA</span></h2>
                        <p class="text-[10px] text-slate-400 font-bold tracking-widest uppercase">Premium BD App</p>
                    </div>
                </div>
                <div class="bg-green-100 p-2 rounded-xl text-bdgreen">
                    <i class="fas fa-headset text-xl"></i>
                </div>
            </div>

            <!-- Admin Message Marquee -->
            <div class="marquee-container">
                <div class="marquee-content" id="admin-message-marquee">
                    Welcome to BIG DHAKA! ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶∏‡ßá‡¶∞‡¶æ ‡¶ü‡ßç‡¶∞‡ßá‡¶°‡¶ø‡¶Ç ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!
                </div>
            </div>

            <!-- Balance Card -->
            <div class="mx-6 mt-4 p-4 premium-card !py-6 flex justify-between items-center">
                <div>
                    <p class="text-[9px] uppercase tracking-[0.2em] opacity-80 mb-1 text-green-100">Total Assets</p>
                    <div class="flex items-center gap-1">
                        <span class="text-xl font-bold text-bdred">‡ß≥</span>
                        <h1 class="text-3xl font-black tracking-tighter balance-text text-white">0.00</h1>
                    </div>
                </div>
                <button onclick="navigateTo('wallet')" class="bg-white/10 px-4 py-2 rounded-lg text-xs font-black text-white border border-white/20 active:scale-95 transition hover:bg-white/20">Wallet</button>
            </div>

            <!-- ======================================================== -->
            <!-- REPLACED SLIDER WITH NEW PREMIUM DESIGN START -->
            <!-- ======================================================== -->
            <div class="mx-6 mt-6 grid grid-cols-2 gap-3">
                <!-- Card 1: Deposit Offer -->
                <div onclick="navigateToPayment('Deposit')" class="bg-gradient-to-br from-bdgreen to-green-900 rounded-3xl p-4 relative overflow-hidden shadow-lg border border-green-400/30 group active:scale-95 transition-transform cursor-pointer">
                    <div class="absolute -right-4 -bottom-4 w-16 h-16 bg-white/10 rounded-full blur-xl"></div>
                    <div class="relative z-10">
                        <div class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center mb-2 text-white">
                            <i class="fas fa-gift text-sm"></i>
                        </div>
                        <h3 class="text-white font-black text-sm uppercase italic">Bonus</h3>
                        <p class="text-[9px] text-green-200 font-bold">100% on Deposit</p>
                    </div>
                </div>

                <!-- Card 2: Official Channel -->
                <div onclick="window.open('https://t.me/BIGDHAKA9', '_blank')" class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-3xl p-4 relative overflow-hidden shadow-lg border border-slate-600 group active:scale-95 transition-transform cursor-pointer">
                    <div class="absolute -right-4 -bottom-4 w-16 h-16 bg-blue-500/10 rounded-full blur-xl"></div>
                    <div class="relative z-10">
                        <div class="w-8 h-8 rounded-full bg-blue-500/20 flex items-center justify-center mb-2 text-blue-400">
                            <i class="fab fa-telegram-plane text-sm"></i>
                        </div>
                        <h3 class="text-white font-black text-sm uppercase italic">Channel</h3>
                        <p class="text-[9px] text-slate-400 font-bold">Join Community</p>
                    </div>
                </div>
            </div>

            <!-- Extra Wide Banner -->
            <div class="mx-6 mt-3 bg-gradient-to-r from-bdred to-red-700 rounded-2xl p-4 flex items-center justify-between shadow-lg relative overflow-hidden active:scale-95 transition-transform cursor-pointer" onclick="navigateTo('referral')">
                <div class="absolute inset-0 opacity-10" style="background-image: repeating-linear-gradient(45deg, transparent, transparent 10px, #000 10px, #000 20px);"></div>
                <div class="relative z-10 text-white">
                    <h3 class="font-black text-lg italic uppercase">Refer & Earn</h3>
                    <p class="text-[10px] opacity-90 font-bold">Invite friends & get lifetime commission!</p>
                </div>
                <div class="relative z-10 bg-white text-bdred w-10 h-10 rounded-full flex items-center justify-center shadow-lg font-black text-xs animate-bounce">
                    GO
                </div>
            </div>
            <!-- ======================================================== -->
            <!-- REPLACED SLIDER WITH NEW PREMIUM DESIGN END -->
            <!-- ======================================================== -->

            <!-- Game List Section -->
            <div class="p-6">
                <div class="flex items-center gap-2 mb-4">
                    <i class="fas fa-fire text-bdred"></i>
                    <h3 class="text-lg font-black text-slate-800 uppercase italic">Popular Games</h3>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div onclick="navigateTo('game')" class="glass-card p-4 relative overflow-hidden group active:scale-95 transition-transform cursor-pointer border-b-4 border-bdgreen h-40 flex flex-col justify-between">
                        <div class="absolute top-0 right-0 w-20 h-20 bg-green-500/10 rounded-bl-full -mr-4 -mt-4"></div>
                        <div class="relative z-10">
                            <div class="w-10 h-10 bg-gradient-to-br from-bdgreen to-green-800 rounded-xl text-white flex items-center justify-center shadow-lg mb-2">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <h4 class="text-xl font-black text-slate-800 italic">WIN GO</h4>
                            <p class="text-[10px] text-slate-500 font-bold leading-tight mt-1">‡¶∏‡¶¨‡ßÅ‡¶ú / ‡¶≤‡¶æ‡¶≤ ‡¶∞‡¶ô‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡ßá‡¶°‡¶ø‡¶ï‡¶∂‡¶®</p>
                        </div>
                    </div>
                    <div onclick="navigateTo('aviator')" class="glass-card p-4 relative overflow-hidden group active:scale-95 transition-transform cursor-pointer border-b-4 border-bdred h-40 flex flex-col justify-between bg-gradient-to-br from-white to-red-50">
                        <div class="absolute top-0 right-0 w-20 h-20 bg-red-500/10 rounded-bl-full -mr-4 -mt-4"></div>
                        <div class="relative z-10">
                            <div class="w-10 h-10 bg-gradient-to-br from-bdred to-red-700 rounded-xl text-white flex items-center justify-center shadow-lg mb-2">
                                <i class="fas fa-plane plane-icon"></i>
                            </div>
                            <h4 class="text-xl font-black text-slate-800 italic">AVIATOR</h4>
                            <p class="text-[10px] text-slate-500 font-bold leading-tight mt-1">‡¶™‡ßç‡¶≤‡ßá‡¶® ‡¶â‡ßú‡¶æ‡¶∞ ‡¶ó‡ßá‡¶Æ!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 1. GAME PAGE (WINGO) -->
        <div id="page-game" class="page">
            <div class="p-4 flex items-center gap-4 bg-white shadow-sm sticky top-0 z-40">
                <button onclick="navigateTo('home')" class="w-10 h-10 rounded-xl bg-green-50 text-bdgreen flex items-center justify-center hover:bg-green-100 transition"><i class="fas fa-arrow-left"></i></button>
                <h2 class="text-lg font-black text-slate-800 italic">Win Go Trading</h2>
            </div>
            <div class="p-6">
                <div class="premium-card text-center py-6">
                    <p class="text-[10px] uppercase tracking-[0.3em] font-black opacity-60 mb-2">Balance</p>
                    <h1 class="text-4xl font-black tracking-tighter">‡ß≥<span class="balance-text">0.00</span></h1>
                </div>
            </div>
            <div class="flex glass-card mx-4 p-2 gap-2">
                <button onclick="switchMarket('30s')" id="tab-30s" class="market-tab active flex-1 py-3 text-xs uppercase">30s</button>
                <button onclick="switchMarket('1m')" id="tab-1m" class="market-tab flex-1 py-3 text-xs uppercase">1m</button>
            </div>
            <div class="mx-4 mt-4 p-6 glass-card flex justify-between items-center border-l-8 border-bdgreen">
                <div><p class="text-[10px] text-slate-400 font-black uppercase mb-1">Period</p><h2 id="period-num" class="text-xl font-bold text-slate-800 font-mono">...</h2></div>
                <div class="text-right"><p class="text-[10px] text-slate-400 font-black uppercase mb-1">Time</p><h2 id="countdown" class="text-4xl font-black text-bdgreen italic">00:00</h2></div>
            </div>
            <div id="betBoard" class="m-4 p-6 glass-card">
                <div class="flex gap-3 mb-8">
                    <button onclick="openBet('Green')" class="btn-3d btn-green-3d flex-1 py-4 rounded-2xl text-white font-black text-xs uppercase">Green</button>
                    <button onclick="openBet('Violet')" class="btn-3d btn-violet-3d flex-1 py-4 rounded-2xl text-white font-black text-xs uppercase">Violet</button>
                    <button onclick="openBet('Red')" class="btn-3d btn-red-3d flex-1 py-4 rounded-2xl text-white font-black text-xs uppercase">Red</button>
                </div>
                <div class="grid grid-cols-5 gap-3 mb-8">
                    <script>
                        for(let i=0; i<=9; i++) {
                            document.write(`<button onclick="openBet('${i}')" class="bg-white shadow-md h-12 w-12 mx-auto rounded-xl flex items-center justify-center text-lg font-black text-slate-600 active:scale-90 transition-all border border-green-100 hover:border-bdgreen">${i}</button>`);
                        }
                    </script>
                </div>
                <div class="flex gap-4">
                    <button onclick="openBet('Big')" class="btn-3d bg-slate-800 text-white flex-1 py-4 rounded-2xl font-black uppercase text-xs" style="box-shadow: 0 8px 0 #000;">Big</button>
                    <button onclick="openBet('Small')" class="btn-3d bg-blue-500 text-white flex-1 py-4 rounded-2xl font-black uppercase text-xs">Small</button>
                </div>
            </div>
            <div class="mx-4 mb-4 glass-card overflow-hidden">
                <div class="bg-slate-800 text-white p-3 text-center text-[10px] font-black uppercase tracking-[0.2em]">History</div>
                <div class="max-h-60 overflow-y-auto">
                    <table class="w-full text-center text-[11px]">
                        <thead class="bg-green-100 text-slate-600 sticky top-0">
                            <tr>
                                <th class="p-2">Period</th>
                                <th class="p-2">Num</th>
                                <th class="p-2">Color</th>
                                <th class="p-2">Size</th>
                            </tr>
                        </thead>
                        <tbody id="history-rows" class="divide-y divide-green-50"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 2. AVIATOR PAGE -->
        <div id="page-aviator" class="page bg-slate-900 min-h-screen pb-32">
            <div class="p-4 flex items-center justify-between bg-slate-800 shadow-md sticky top-0 z-40 border-b border-slate-700">
                <div class="flex items-center gap-3">
                    <button onclick="navigateTo('home')" class="w-10 h-10 rounded-xl bg-slate-700 text-slate-300 flex items-center justify-center hover:bg-slate-600 transition"><i class="fas fa-arrow-left"></i></button>
                    <h2 class="text-lg font-black text-white italic tracking-wider"><span class="text-bdred">AVIATOR</span></h2>
                </div>
                <div class="bg-slate-700 px-3 py-1 rounded-full border border-slate-600">
                    <span class="text-bdred font-bold">‡ß≥</span> <span class="text-white font-mono font-bold balance-text">0.00</span>
                </div>
            </div>
            <div class="p-4">
                <div class="flex gap-2 overflow-x-auto pb-2 mb-2 no-scrollbar" id="aviator-history"></div>
                <div class="aviator-canvas-container relative mb-4">
                    <div class="absolute inset-0" style="background-image: radial-gradient(#064e3b 1px, transparent 1px); background-size: 20px 20px; opacity: 0.3;"></div>
                    <div class="absolute inset-0 flex flex-col items-center justify-center z-20">
                        <div id="aviator-loader" class="text-bdred font-black text-xl animate-pulse hidden">WAITING FOR NEXT ROUND...</div>
                        <h1 id="fly-val" class="text-6xl font-black text-white italic drop-shadow-xl font-mono">1.00x</h1>
                        <p id="crashed-text" class="text-bdred font-black text-2xl uppercase hidden mt-2">FLEW AWAY!</p>
                    </div>
                    <div id="plane-box" class="absolute bottom-0 left-0 w-full h-full pointer-events-none transition-transform duration-100 ease-linear">
                        <div class="fly-line" id="fly-line"></div>
                        <i class="fas fa-plane text-bdred text-4xl absolute transition-all duration-100" id="fly-plane" style="bottom: 0px; left: 0px; filter: drop-shadow(0 0 10px rgba(244, 42, 65, 0.8));"></i>
                    </div>
                </div>
                <div class="glass-card bg-slate-800 border-slate-700 p-4">
                    <div class="flex gap-2 mb-4">
                        <div class="flex-1">
                            <label class="text-[10px] text-slate-400 font-bold uppercase">Amount</label>
                            <div class="flex items-center bg-slate-900 rounded-xl border border-slate-600 overflow-hidden mt-1">
                                <button onclick="adjAvBet(-10)" class="p-3 text-slate-400 hover:text-white"><i class="fas fa-minus"></i></button>
                                <input type="number" id="aviator-bet-amt" class="w-full bg-transparent text-center text-white font-bold outline-none" value="10">
                                <button onclick="adjAvBet(10)" class="p-3 text-slate-400 hover:text-white"><i class="fas fa-plus"></i></button>
                            </div>
                            <div class="flex gap-1 mt-2">
                                <button onclick="setAvBet(50)" class="flex-1 bg-slate-700 rounded text-[10px] text-slate-300 py-1 hover:bg-slate-600">50</button>
                                <button onclick="setAvBet(100)" class="flex-1 bg-slate-700 rounded text-[10px] text-slate-300 py-1 hover:bg-slate-600">100</button>
                                <button onclick="setAvBet(500)" class="flex-1 bg-slate-700 rounded text-[10px] text-slate-300 py-1 hover:bg-slate-600">500</button>
                            </div>
                        </div>
                    </div>
                    <button id="btn-aviator-main" onclick="handleAviatorMainBtn()" class="w-full btn-3d btn-aviator-bet text-white py-5 rounded-2xl text-xl font-black uppercase tracking-widest">BET</button>
                </div>
            </div>
        </div>

        <!-- REFERRAL PAGE -->
        <div id="page-referral" class="page p-6 bg-green-50 min-h-screen">
            <div class="text-center mb-8 pt-4">
                <div class="w-20 h-20 bg-gradient-to-tr from-bdgold to-orange-600 rounded-full mx-auto flex items-center justify-center shadow-lg shadow-orange-300/50 mb-4 animate-bounce border-4 border-white">
                    <i class="fas fa-gift text-4xl text-white"></i>
                </div>
                <h2 class="text-3xl font-black text-slate-800 italic uppercase">Invite & <span class="text-bdgreen">Earn</span></h2>
                <div class="mt-4 bg-white rounded-2xl p-4 shadow-sm border border-green-100">
                    <p class="text-bdgreen font-black text-[11px] uppercase tracking-wider mb-3">‡ß©-‡¶≤‡ßá‡¶≠‡ßá‡¶≤ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ</p>
                    <div class="space-y-2">
                        <div class="flex justify-between text-[10px] font-bold bg-green-50 p-2 rounded-lg border border-green-100"><span class="text-slate-600">‡¶≤‡ßá‡¶≠‡ßá‡¶≤ ‡ßß: ‡ßß‡ß¶‡ß¶‡ß≥ ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü‡ßá</span><span class="text-bdgreen">‡ßß‡ß¶‡ß¶‡ß≥ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏</span></div>
                        <div class="flex justify-between text-[10px] font-bold bg-orange-50 p-2 rounded-lg border border-orange-100"><span class="text-slate-600">‡¶≤‡ßá‡¶≠‡ßá‡¶≤ ‡ß®: ‡ßß‡ß¶‡ß¶‡ß≥ ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü‡ßá</span><span class="text-orange-600">‡ß´‡ß¶‡ß≥ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏</span></div>
                        <div class="flex justify-between text-[10px] font-bold bg-red-50 p-2 rounded-lg border border-red-100"><span class="text-slate-600">‡¶≤‡ßá‡¶≠‡ßá‡¶≤ ‡ß©: ‡ßß‡ß¶‡ß¶‡ß≥ ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü‡ßá</span><span class="text-bdred">‡ß®‡ß´‡ß≥ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏</span></div>
                    </div>
                </div>
            </div>
            <div class="premium-card mb-8">
                <p class="text-[10px] uppercase font-black opacity-70 tracking-[0.2em] mb-2 text-center text-white">Your Referral Code</p>
                <div class="bg-white/20 backdrop-blur-md rounded-xl p-4 flex justify-between items-center border border-white/30">
                    <h2 class="text-2xl font-black tracking-widest text-white font-mono" id="ref-uid">LOADING</h2>
                    <button onclick="copyReferral()" class="bg-white text-bdgreen px-4 py-2 rounded-lg text-xs font-black shadow-lg active:scale-95 transition">COPY</button>
                </div>
            </div>
            <button onclick="openTeamModal()" class="w-full btn-3d bg-slate-800 text-white py-4 rounded-2xl font-black uppercase tracking-widest flex items-center justify-center gap-2 mb-6">
                <i class="fas fa-users"></i> MY TEAM INFO
            </button>
            <h4 class="text-[11px] font-black text-slate-400 uppercase tracking-widest mb-3 ml-1">Referral Statistics</h4>
            <div class="grid grid-cols-3 gap-2 mb-6">
                <div class="glass-card p-3 flex flex-col items-center justify-center border-b-4 border-bdgreen"><span class="text-[8px] font-black uppercase text-slate-400 mb-1">Level 1</span><h3 class="text-lg font-black text-slate-800" id="ref-count-l1">0</h3></div>
                <div class="glass-card p-3 flex flex-col items-center justify-center border-b-4 border-orange-500"><span class="text-[8px] font-black uppercase text-slate-400 mb-1">Level 2</span><h3 class="text-lg font-black text-slate-800" id="ref-count-l2">0</h3></div>
                <div class="glass-card p-3 flex flex-col items-center justify-center border-b-4 border-bdred"><span class="text-[8px] font-black uppercase text-slate-400 mb-1">Level 3</span><h3 class="text-lg font-black text-slate-800" id="ref-count-l3">0</h3></div>
            </div>
            <div class="glass-card p-5 flex justify-between items-center mb-8 border-l-8 border-bdgreen">
                <div><p class="text-[9px] font-black uppercase text-slate-400 tracking-widest">Total Commission</p><h3 class="text-2xl font-black text-slate-800">‡ß≥<span id="ref-total-earn">0.00</span></h3></div>
                <div class="w-12 h-12 bg-green-100 text-bdgreen rounded-2xl flex items-center justify-center text-xl"><i class="fas fa-coins"></i></div>
            </div>
            <button onclick="copyReferral()" class="w-full btn-3d bg-bdgreen text-white py-5 rounded-2xl font-black uppercase tracking-widest flex items-center justify-center gap-2 shadow-green-600/50">
                <i class="fas fa-share-nodes"></i> Share Link
            </button>
        </div>

        <!-- 3. WALLET PAGE -->
        <div id="page-wallet" class="page p-6">
            <h2 class="text-3xl font-black text-slate-800 mb-8 italic uppercase">My <span class="text-bdgreen">Wallet</span></h2>
            <div class="premium-card mb-8">
                <div class="flex justify-between items-start mb-10">
                    <div>
                        <p class="text-[10px] uppercase font-black opacity-50 tracking-[0.2em] mb-1">Total Balance</p>
                        <h1 class="text-4xl font-black balance-text tracking-tighter">0.00</h1>
                    </div>
                    <div class="bg-white/20 p-3 rounded-2xl"><i class="fas fa-wallet text-white text-xl"></i></div>
                </div>
                <p class="text-xs font-black tracking-widest" id="wallet-uid">UID: ...</p>
            </div>
            <div class="grid grid-cols-2 gap-4 mb-8">
                <button onclick="navigateToPayment('Deposit')" class="glass-card p-6 flex flex-col items-center gap-3 border-b-4 border-bdgreen">
                    <div class="w-12 h-12 bg-green-100 text-bdgreen rounded-2xl flex items-center justify-center text-xl shadow-inner"><i class="fas fa-arrow-down"></i></div>
                    <span class="font-black text-[10px] uppercase tracking-widest text-slate-600">Deposit</span>
                </button>
                <button onclick="navigateToPayment('Withdraw')" class="glass-card p-6 flex flex-col items-center gap-3 border-b-4 border-bdred">
                    <div class="w-12 h-12 bg-red-100 text-bdred rounded-2xl flex items-center justify-center text-xl shadow-inner"><i class="fas fa-arrow-up"></i></div>
                    <span class="font-black text-[10px] uppercase tracking-widest text-slate-600">Withdraw</span>
                </button>
            </div>
            <div class="glass-card p-6 overflow-hidden">
                <h3 class="text-xs font-black uppercase text-slate-400 mb-4">Recent Transactions</h3>
                <div class="space-y-4" id="transaction-list"><p class="text-center text-xs text-slate-400">No transactions yet</p></div>
            </div>
        </div>

        <!-- NEW: PAYMENT PAGE -->
        <div id="page-payment" class="page p-6">
            <div class="flex items-center gap-4 mb-6">
                <button onclick="navigateTo('wallet')" class="w-10 h-10 rounded-xl bg-slate-100 text-slate-500 flex items-center justify-center"><i class="fas fa-arrow-left"></i></button>
                <h2 id="payment-title" class="text-2xl font-black text-slate-800 uppercase">Deposit</h2>
            </div>

            <div class="bg-white w-full rounded-[40px] p-8 shadow-2xl border-t-4 border-bdgreen">
                <div class="flex gap-4 mb-8">
                    <div onclick="selectMethod('bKash')" id="method-bKash" class="flex-1 border-2 p-4 rounded-2xl text-center cursor-pointer transition-all grayscale hover:grayscale-0">
                        <img src="https://freelogopng.com/images/all_img/1656234745bkash-app-logo-png.png" class="h-10 mx-auto mb-2 object-contain">
                        <span class="text-[9px] font-black uppercase text-pink-600">bKash</span>
                    </div>
                    <div onclick="selectMethod('Nagad')" id="method-Nagad" class="flex-1 border-2 p-4 rounded-2xl text-center cursor-pointer transition-all grayscale hover:grayscale-0">
                        <img src="https://freelogopng.com/images/all_img/1679248787Nagad-Logo.png" class="h-10 mx-auto mb-2 object-contain">
                        <span class="text-[9px] font-black uppercase text-orange-600">Nagad</span>
                    </div>
                </div>
                <div id="deposit-ui" class="hidden glass-card p-6 mb-8 bg-green-50">
                    <div class="bg-green-100 p-3 rounded-xl mb-4 text-center">
                        <p class="text-[10px] text-green-800 font-bold leading-relaxed">
                            ‡ßß. ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞‡ßá <span class="font-black text-bdgreen">Send Money</span> ‡¶ï‡¶∞‡ßÅ‡¶®‡•§<br>
                            ‡ß®. ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶™‡¶∞ <span class="font-black text-bdgreen">TrxID</span> ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßá ‡¶®‡¶ø‡¶ö‡ßá ‡¶¨‡¶∏‡¶æ‡¶®‡•§
                        </p>
                    </div>
                    <p class="text-[9px] text-bdgreen font-black mb-2 uppercase text-center">Agent Number</p>
                    <div class="flex justify-between items-center bg-white p-4 rounded-xl border border-green-200">
                        <span id="admin-num" class="font-black text-slate-700 text-lg">01734153584</span>
                        <button onclick="copyNum()" class="text-bdgreen font-black text-xs uppercase">Copy</button>
                    </div>
                    <input type="text" id="wallet-tid" class="w-full mt-4 bg-white border p-4 rounded-xl font-black text-center outline-none" placeholder="Transaction ID (TRX)">
                </div>
                <div id="withdraw-ui" class="hidden space-y-4 mb-8">
                    <input type="number" id="withdraw-number" class="w-full bg-slate-50 p-4 rounded-xl font-bold border" placeholder="Account Number">
                </div>
                <input type="number" id="wallet-amt" class="w-full border-b-4 border-bdgreen p-4 text-center text-4xl font-black outline-none mb-8" placeholder="‡ß≥ 0.00">
                <button onclick="handleWalletAction()" class="w-full btn-3d btn-green-3d text-white py-5 rounded-2xl font-black uppercase">Confirm</button>
            </div>
        </div>

        <!-- 5. ACCOUNT PAGE (UPDATED WITH EDIT & DETAILS) -->
        <div id="page-account" class="page bg-[#f0fdf4]">
            <!-- Profile Header -->
            <div class="relative bg-gradient-to-br from-bdgreen via-green-700 to-green-900 pb-28 pt-12 px-8 rounded-b-[50px] shadow-2xl border-b-4 border-bdred">
                <div class="flex items-center gap-6">
                    <div class="relative">
                        <div class="w-24 h-24 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center text-4xl text-white shadow-2xl border-4 border-white/30">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <div class="absolute bottom-0 right-0 w-8 h-8 bg-bdred border-4 border-white rounded-full"></div>
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center gap-2">
                            <h2 class="text-2xl font-black text-white italic tracking-tight" id="display-username">BIG DHAKA TRADER</h2>
                            <button onclick="openNameModal()" class="w-6 h-6 bg-white/20 rounded-full flex items-center justify-center text-white text-xs hover:bg-white/40 transition"><i class="fas fa-pen"></i></button>
                        </div>
                        <div class="flex items-center gap-2 mt-1">
                            <span class="bg-bdgold text-slate-900 px-3 py-0.5 rounded-full text-[10px] font-black tracking-widest uppercase">VIP 1</span>
                            <span class="text-white/70 text-xs font-bold font-mono" id="profile-uid">UID: Loading...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Summary Cards -->
            <div class="px-6 -mt-16 grid grid-cols-2 gap-4">
                <div class="glass-card p-5 border-b-4 border-bdgreen flex flex-col items-center bg-white">
                    <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">Total Balance</span>
                    <h3 class="text-xl font-black text-slate-800">‡ß≥ <span class="balance-text">0.00</span></h3>
                </div>
                <div class="glass-card p-5 border-b-4 border-bdred flex flex-col items-center bg-white">
                    <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">Win Rate</span>
                    <h3 class="text-xl font-black text-slate-800">78.5%</h3>
                </div>
            </div>

            <!-- Menu Sections -->
            <div class="px-6 mt-8 space-y-3">
                <h4 class="text-[11px] font-black text-slate-400 uppercase tracking-[0.2em] ml-2">Personal Settings</h4>

                <div onclick="openGiftModal()" class="account-menu-item">
                    <div class="w-10 h-10 rounded-xl bg-pink-50 text-pink-600 flex items-center justify-center"><i class="fas fa-gift"></i></div>
                    <div class="flex-1 font-black text-sm text-slate-700">Gift Code</div>
                    <i class="fas fa-chevron-right text-slate-300 text-xs"></i>
                </div>

                <div onclick="openDetailsModal()" class="account-menu-item">
                    <div class="w-10 h-10 rounded-xl bg-blue-50 text-blue-600 flex items-center justify-center"><i class="fas fa-id-card"></i></div>
                    <div class="flex-1 font-black text-sm text-slate-700">Account Details</div>
                    <i class="fas fa-chevron-right text-slate-300 text-xs"></i>
                </div>

                <div onclick="navigateTo('wallet')" class="account-menu-item">
                    <div class="w-10 h-10 rounded-xl bg-purple-50 text-purple-600 flex items-center justify-center"><i class="fas fa-history"></i></div>
                    <div class="flex-1 font-black text-sm text-slate-700">Transaction History</div>
                    <i class="fas fa-chevron-right text-slate-300 text-xs"></i>
                </div>

                <!-- NEW: BETTING HISTORY BUTTON -->
                <div onclick="openBetHistory()" class="account-menu-item">
                    <div class="w-10 h-10 rounded-xl bg-indigo-50 text-indigo-600 flex items-center justify-center"><i class="fas fa-list-alt"></i></div>
                    <div class="flex-1 font-black text-sm text-slate-700">Betting History</div>
                    <i class="fas fa-chevron-right text-slate-300 text-xs"></i>
                </div>

                <div onclick="openPasswordModal()" class="account-menu-item">
                    <div class="w-10 h-10 rounded-xl bg-orange-50 text-orange-600 flex items-center justify-center"><i class="fas fa-key"></i></div>
                    <div class="flex-1 font-black text-sm text-slate-700">Change Password</div>
                    <i class="fas fa-chevron-right text-slate-300 text-xs"></i>
                </div>

                <div onclick="window.open('https://t.me/BIGDHAKA9', '_blank')" class="account-menu-item">
                    <div class="w-10 h-10 rounded-xl bg-green-50 text-bdgreen flex items-center justify-center"><i class="fas fa-headset"></i></div>
                    <div class="flex-1 font-black text-sm text-slate-700">Support 24/7</div>
                    <i class="fas fa-chevron-right text-slate-300 text-xs"></i>
                </div>

                <div class="pt-6">
                    <button onclick="handleLogout()" class="w-full py-5 rounded-2xl bg-white border border-red-100 text-bdred font-black text-xs uppercase tracking-widest shadow-sm active:scale-95 transition flex items-center justify-center gap-3">
                        <i class="fas fa-power-off"></i> Logout
                    </button>
                    <p class="text-center text-[10px] text-slate-400 font-bold mt-4">Version 2.0.5 BD Premium</p>
                </div>
            </div>
        </div>

        <!-- NAVIGATION BAR -->
        <nav class="fixed bottom-4 left-4 right-4 max-w-[400px] mx-auto glass-card flex justify-around py-4 px-2 z-[100] border-t-2 border-bdgreen">
            <button onclick="navigateTo('home')" class="nav-btn active flex flex-col items-center gap-1" id="nav-home">
                <i class="fas fa-home text-xl"></i>
                <span class="text-[8px] font-black uppercase">Home</span>
            </button>
            <button onclick="navigateTo('referral')" class="nav-btn flex flex-col items-center gap-1" id="nav-referral">
                <i class="fas fa-share-nodes text-xl"></i>
                <span class="text-[8px] font-black uppercase">Refer</span>
            </button>
            <button onclick="navigateTo('wallet')" class="nav-btn flex flex-col items-center gap-1" id="nav-wallet">
                <i class="fas fa-wallet text-xl"></i>
                <span class="text-[8px] font-black uppercase">Wallet</span>
            </button>
            <button onclick="navigateTo('account')" class="nav-btn flex flex-col items-center gap-1" id="nav-account">
                <i class="fas fa-user text-xl"></i>
                <span class="text-[8px] font-black uppercase">Me</span>
            </button>
        </nav>

        <!-- BET MODAL -->
        <div id="betModal" class="fixed inset-0 bg-black/60 z-[200] hidden flex items-end justify-center backdrop-blur-sm">
            <div class="bg-white w-full max-w-md p-8 rounded-t-[40px] shadow-2xl">
                <div class="w-12 h-1.5 bg-slate-200 mx-auto rounded-full mb-8"></div>
                <div class="flex justify-between items-center mb-8">
                    <h2 id="target" class="text-3xl font-black uppercase italic tracking-tighter text-slate-800">Select</h2>
                    <div class="bg-green-100 px-4 py-2 rounded-xl text-bdgreen font-black">‡ß≥<span class="balance-text">0.00</span></div>
                </div>
                <div class="grid grid-cols-4 gap-2 mb-8">
                    <button onclick="setMoney(10)" class="bg-slate-50 py-3 rounded-xl font-black text-slate-600 active:bg-bdgreen active:text-white transition-all">10</button>
                    <button onclick="setMoney(100)" class="bg-slate-50 py-3 rounded-xl font-black text-slate-600 active:bg-bdgreen active:text-white">100</button>
                    <button onclick="setMoney(500)" class="bg-slate-50 py-3 rounded-xl font-black text-slate-600 active:bg-bdgreen active:text-white">500</button>
                    <button onclick="setMoney(1000)" class="bg-slate-50 py-3 rounded-xl font-black text-slate-600 active:bg-bdgreen active:text-white">1k</button>
                </div>
                <input type="number" id="bet-amt" class="w-full bg-slate-50 border-2 border-slate-100 p-6 rounded-2xl text-center text-4xl font-black text-slate-800 outline-none" value="10">
                <div class="flex gap-4 mt-8">
                    <button onclick="closeBet()" class="flex-1 py-4 font-black text-slate-400 uppercase">Cancel</button>
                    <button onclick="confirmBet()" class="flex-[2] btn-3d bg-bdgreen text-white py-4 rounded-2xl font-black uppercase">Place Bet</button>
                </div>
            </div>
        </div>

        <!-- TEAM DETAILS MODAL -->
        <div id="teamModal" class="fixed inset-0 bg-black/80 z-[300] hidden flex items-center justify-center p-4 backdrop-blur-md">
            <div class="bg-white w-full max-w-sm rounded-[40px] p-6 shadow-2xl relative h-[80vh] flex flex-col">
                <div class="flex justify-between items-center mb-6 border-b pb-4">
                    <h2 class="text-xl font-black uppercase text-slate-800">My Team</h2>
                    <button onclick="document.getElementById('teamModal').classList.add('hidden')" class="text-slate-300 text-xl"><i class="fas fa-times-circle"></i></button>
                </div>
                <div id="team-detail-list" class="space-y-3 overflow-y-auto flex-1 pr-2">
                    <p class="text-center text-slate-400 mt-10">Loading team data...</p>
                </div>
            </div>
        </div>

        <!-- GIFT CODE MODAL -->
        <div id="giftModal" class="fixed inset-0 bg-black/80 z-[200] hidden flex items-center justify-center p-4 backdrop-blur-md">
            <div class="bg-white w-full max-w-sm rounded-[40px] p-8 shadow-2xl relative">
                <button onclick="document.getElementById('giftModal').classList.add('hidden')" class="absolute top-4 right-4 text-slate-300 text-xl"><i class="fas fa-times-circle"></i></button>
                <div class="text-center mb-6">
                    <i class="fas fa-gift text-5xl text-pink-500 mb-4 animate-bounce"></i>
                    <h2 class="text-2xl font-black uppercase text-slate-800 italic">Redeem Code</h2>
                </div>
                <input type="text" id="gift-code-input" class="w-full bg-slate-50 border-2 border-pink-100 p-4 rounded-2xl text-center text-xl font-black text-slate-800 outline-none uppercase placeholder:text-slate-300 mb-6" placeholder="ENTER CODE">
                <button onclick="redeemCode()" class="w-full btn-3d bg-pink-600 text-white py-4 rounded-2xl font-black uppercase shadow-pink-500/50">Claim Bonus</button>
            </div>
        </div>

        <!-- EDIT NAME MODAL -->
        <div id="nameModal" class="fixed inset-0 bg-black/80 z-[300] hidden flex items-center justify-center p-4 backdrop-blur-md">
            <div class="bg-white w-full max-w-sm rounded-[30px] p-6 shadow-2xl relative">
                <button onclick="document.getElementById('nameModal').classList.add('hidden')" class="absolute top-4 right-4 text-slate-300 text-xl"><i class="fas fa-times-circle"></i></button>
                <h2 class="text-xl font-black uppercase text-slate-800 mb-4">Edit Username</h2>
                <input type="text" id="new-username" class="w-full bg-slate-50 border p-4 rounded-xl font-bold outline-none mb-4" placeholder="Enter new name">
                <button onclick="saveUsername()" class="w-full btn-3d bg-bdgreen text-white py-3 rounded-xl font-black uppercase">Save Change</button>
            </div>
        </div>

        <!-- ACCOUNT DETAILS MODAL -->
        <div id="detailsModal" class="fixed inset-0 bg-black/80 z-[300] hidden flex items-center justify-center p-4 backdrop-blur-md">
            <div class="bg-white w-full max-w-sm rounded-[30px] p-8 shadow-2xl relative">
                <button onclick="document.getElementById('detailsModal').classList.add('hidden')" class="absolute top-4 right-4 text-slate-300 text-xl"><i class="fas fa-times-circle"></i></button>
                <h2 class="text-2xl font-black uppercase text-slate-800 mb-6 border-b pb-2">My Profile</h2>

                <div class="space-y-4">
                    <div class="flex justify-between items-center border-b border-slate-50 pb-2">
                        <span class="text-xs font-bold text-slate-400 uppercase">User ID</span>
                        <span class="font-black text-slate-800 font-mono" id="detail-uid">...</span>
                    </div>
                    <div class="flex justify-between items-center border-b border-slate-50 pb-2">
                        <span class="text-xs font-bold text-slate-400 uppercase">Email</span>
                        <span class="font-bold text-slate-800 text-xs" id="detail-email">...</span>
                    </div>
                    <div class="flex justify-between items-center border-b border-slate-50 pb-2">
                        <span class="text-xs font-bold text-slate-400 uppercase">Phone</span>
                        <span class="font-bold text-slate-800" id="detail-phone">...</span>
                    </div>
                    <div class="flex justify-between items-center border-b border-slate-50 pb-2">
                        <span class="text-xs font-bold text-slate-400 uppercase">Country</span>
                        <span class="font-bold text-slate-800" id="detail-country">...</span>
                    </div>
                    <div class="flex justify-between items-center border-b border-slate-50 pb-2">
                        <span class="text-xs font-bold text-slate-400 uppercase">Joined</span>
                        <span class="font-bold text-slate-800 text-xs" id="detail-join">...</span>
                    </div>
                    <div class="flex justify-between items-center pt-2">
                        <span class="text-xs font-bold text-slate-400 uppercase">Referred By</span>
                        <span class="font-black text-bdgreen" id="detail-ref">NONE</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- NEW: BETTING HISTORY MODAL -->
        <div id="betHistoryModal" class="fixed inset-0 bg-black/80 z-[300] hidden flex items-center justify-center p-4 backdrop-blur-md">
            <div class="bg-white w-full max-w-sm rounded-[40px] p-6 shadow-2xl relative h-[80vh] flex flex-col">
                <div class="flex justify-between items-center mb-6 border-b pb-4">
                    <h2 class="text-xl font-black uppercase text-slate-800">My Betting History</h2>
                    <button onclick="document.getElementById('betHistoryModal').classList.add('hidden')" class="text-slate-300 text-xl"><i class="fas fa-times-circle"></i></button>
                </div>
                <div id="bet-history-list" class="space-y-3 overflow-y-auto flex-1 pr-2">
                    <p class="text-center text-slate-400 mt-10">Loading history...</p>
                </div>
            </div>
        </div>

        <!-- CHANGE PASSWORD MODAL -->
        <div id="passModal" class="fixed inset-0 bg-black/80 z-[300] hidden flex items-center justify-center p-4 backdrop-blur-md">
            <div class="bg-white w-full max-w-sm rounded-[30px] p-6 shadow-2xl relative">
                <button onclick="document.getElementById('passModal').classList.add('hidden')" class="absolute top-4 right-4 text-slate-300 text-xl"><i class="fas fa-times-circle"></i></button>
                <h2 class="text-xl font-black uppercase text-slate-800 mb-4">Security</h2>
                <div class="space-y-3">
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase">New Password</label>
                        <input type="password" id="new-pass" class="w-full bg-slate-50 border p-3 rounded-xl font-bold outline-none" placeholder="Min 6 chars">
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase">Confirm Password</label>
                        <input type="password" id="confirm-new-pass" class="w-full bg-slate-50 border p-3 rounded-xl font-bold outline-none" placeholder="Confirm">
                    </div>
                    <button onclick="changePassword()" class="w-full btn-3d bg-orange-500 text-white py-3 rounded-xl font-black uppercase mt-2">Update Password</button>
                </div>
            </div>
        </div>

    </div>

    <!-- FIREBASE AND GAME LOGIC -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, update, push, get, child } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, updatePassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // ==========================================
        // CONFIGURATION START
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyAKN2WDGN6BiLoLguBGKa_xreYOWkOpgsc",
            authDomain: "big-dhaka-v2-84a1c.firebaseapp.com",
            databaseURL: "https://big-dhaka-v2-84a1c-default-rtdb.firebaseio.com",
            projectId: "big-dhaka-v2-84a1c",
            storageBucket: "big-dhaka-v2-84a1c.firebasestorage.app",
            messagingSenderId: "803615001514",
            appId: "1:803615001514:web:840613baee1e318ea1b9d3"
        };
        // ==========================================
        // CONFIGURATION END
        // ==========================================

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);

        let wallet = 0;
        let userId = null;
        let mode = '30s';
        let walletActionType = 'Deposit';
        let selectedMethod = '';
        let currentTurnover = 0;

        // ADMIN CONTROL VARIABLES
        let forcedWingoResult = -1; // -1: Random, 0-9: Forced
        let forcedAviatorCrash = -1; // -1: Random, >1.0: Forced Crash

        // AVIATOR VARIABLES
        let avState = 'WAITING';
        let avMultiplier = 1.00;
        let avCrashPoint = 0;
        let avQueuedBet = 0;
        let avMyBet = 0;
        let avInterval = null;

        const gameData = {
            '30s': { t: 0, d: 30, p: 0, history: [], bets: [] },
            '1m': { t: 0, d: 60, p: 0, history: [], bets: [] }
        };

        // --- LOADER LOGIC ---
        window.addEventListener('load', () => {
            setTimeout(() => {
                const loader = document.getElementById('app-loader');
                loader.style.opacity = '0';
                loader.style.visibility = 'hidden';
            }, 2500); 
        });

        // --- AUTH LOGIC ---

        onAuthStateChanged(auth, (user) => {
            setTimeout(() => {
                if (user) {
                    userId = user.uid;
                    document.getElementById('auth-page').classList.add('hidden');
                    document.getElementById('main-app').classList.remove('hidden');
                    initApp(userId);
                } else {
                    userId = null;
                    document.getElementById('auth-page').classList.remove('hidden');
                    document.getElementById('main-app').classList.add('hidden');
                }
            }, 500);
        });

        window.toggleAuth = (tab) => {
            const loginBtn = document.getElementById('tab-login');
            const signupBtn = document.getElementById('tab-signup');
            const loginForm = document.getElementById('form-login');
            const signupForm = document.getElementById('form-signup');

            if(tab === 'login') {
                loginBtn.classList.replace('text-slate-400', 'text-bdgreen');
                loginBtn.classList.add('bg-white', 'shadow-md');
                signupBtn.classList.replace('text-bdgreen', 'text-slate-400');
                signupBtn.classList.remove('bg-white', 'shadow-md');
                loginForm.classList.remove('hidden');
                signupForm.classList.add('hidden');
            } else {
                signupBtn.classList.replace('text-slate-400', 'text-bdgreen');
                signupBtn.classList.add('bg-white', 'shadow-md');
                loginBtn.classList.replace('text-bdgreen', 'text-slate-400');
                loginBtn.classList.remove('bg-white', 'shadow-md');
                signupForm.classList.remove('hidden');
                loginForm.classList.add('hidden');
            }
            document.getElementById('auth-error').innerText = "";
        };

        window.handleRegister = () => {
            const email = document.getElementById('reg-email').value;
            const phone = document.getElementById('reg-phone').value;
            const country = document.getElementById('reg-country').value;
            const refCode = document.getElementById('reg-ref').value.toUpperCase().trim();
            const pass = document.getElementById('reg-pass').value;
            const confirm = document.getElementById('reg-pass-confirm').value;
            const terms = document.getElementById('reg-terms').checked;
            const errorEl = document.getElementById('auth-error');

            if(!terms) { errorEl.innerText = "Please accept Terms & Conditions"; return; }
            if(!phone) { errorEl.innerText = "Phone number required!"; return; }
            if(pass !== confirm) { errorEl.innerText = "Passwords do not match!"; return; }
            if(pass.length < 6) { errorEl.innerText = "Password must be at least 6 characters."; return; }

            errorEl.innerText = "Creating account...";

            let referrerUid = null;

            const processRegistration = () => {
                createUserWithEmailAndPassword(auth, email, pass)
                .then((userCredential) => {
                    const user = userCredential.user;
                    const myRefCode = user.uid.slice(0, 8).toUpperCase();

                    const userData = {
                        uid: user.uid,
                        email: email,
                        phone: phone,
                        country: country,
                        invitedBy: referrerUid ? referrerUid : "NONE",
                        refCode: myRefCode,
                        balance: 0,
                        commission_total: 0,
                        total_deposit: 0,
                        total_wagered: 0,
                        username: "BIG DHAKA TRADER",
                        password: pass,
                        createdAt: new Date().toISOString()
                    };

                    const updates = {};
                    updates['users/' + user.uid] = userData;
                    updates['referral_codes/' + myRefCode] = user.uid;

                    if(referrerUid) {
                        updates['users/' + referrerUid + '/referrals/' + user.uid] = {
                            level: 1,
                            joinDate: new Date().toISOString()
                        };
                    }

                    update(ref(db), updates).then(() => {});
                })
                .catch((error) => {
                    errorEl.innerText = error.message;
                });
            };

            if(refCode) {
                get(ref(db, 'referral_codes/' + refCode)).then((snapshot) => {
                    if(snapshot.exists()) {
                        referrerUid = snapshot.val();
                        processRegistration();
                    } else {
                        errorEl.innerText = "Invalid Referral Code!";
                    }
                });
            } else {
                processRegistration();
            }
        };

        window.handleLogin = () => {
            const email = document.getElementById('login-email').value;
            const pass = document.getElementById('login-pass').value;
            const errorEl = document.getElementById('auth-error');
            errorEl.innerText = "Logging in...";
            signInWithEmailAndPassword(auth, email, pass).catch((error) => {
                errorEl.innerText = "Invalid Email or Password";
            });
        };

        window.handleLogout = () => {
            if(confirm("Are you sure you want to log out?")) {
                signOut(auth).then(() => location.reload());
            }
        };

        function initApp(uid) {
            const displayUid = uid.slice(0, 8).toUpperCase();
            document.querySelectorAll('[id$="uid"]').forEach(el => el.innerText = "UID: " + displayUid);
            const refEl = document.getElementById('ref-uid');
            if(refEl) refEl.innerText = displayUid;

            onValue(ref(db, 'users/' + uid), (snap) => {
                const data = snap.val();
                wallet = parseFloat(data?.balance || 0);
                const comm = parseFloat(data?.commission_total || 0);
                currentTurnover = parseFloat(data?.total_wagered || 0);

                const username = data?.username || "BIG DHAKA TRADER";
                document.getElementById('display-username').innerText = username;

                document.querySelectorAll('.balance-text').forEach(el => el.innerText = wallet.toFixed(2));
                const refEarnEl = document.getElementById('ref-total-earn');
                if(refEarnEl) refEarnEl.innerText = comm.toFixed(2);
            });

            onValue(ref(db, 'admin_message/current_message'), (snapshot) => {
                const message = snapshot.val();
                const marqueeEl = document.getElementById('admin-message-marquee');
                if (message) {
                    marqueeEl.innerText = message;
                    marqueeEl.parentNode.style.display = 'block'; 
                } else {
                    marqueeEl.innerText = "Welcome to BIG DHAKA! Stay tuned for exciting updates!";
                    marqueeEl.parentNode.style.display = 'block';
                }
            });

            onValue(ref(db, `users/${uid}/referrals`), (snap) => {
                const countL1El = document.getElementById('ref-count-l1');
                if(snap.exists()) { if(countL1El) countL1El.innerText = snap.size; }
                else { if(countL1El) countL1El.innerText = "0"; }
            });

            onValue(ref(db, 'admin_control/wingo'), (snap) => { forcedWingoResult = snap.exists() ? parseInt(snap.val()) : -1; });
            onValue(ref(db, 'admin_control/aviator'), (snap) => { forcedAviatorCrash = snap.exists() ? parseFloat(snap.val()) : -1; });

            onValue(ref(db, 'transactions'), (snap) => {
                const list = document.getElementById('transaction-list');
                list.innerHTML = '';
                snap.forEach(c => {
                    const t = c.val();
                    if(t.uid === uid) {
                        let color = t.status === 'approved' ? 'text-green-600' : 'text-orange-500';
                        list.innerHTML += `<div class="flex justify-between items-center"><div class="text-xs font-bold">${t.type}</div><div class="${color} font-black">${t.amount}</div></div>`;
                    }
                });
            });

            // --- PREFILL HISTORY FOR CONSISTENCY ---
            prefillHistory('30s', 30);
            prefillHistory('1m', 60);

            runWinGo();
            startAviatorLoop();
        }

        // ==========================================
        // SYNCED WINGO LOGIC START
        // ==========================================
        
        // 1. Deterministic Random Generator (Syncs across all clients)
        function getDeterministicResult(periodId) {
            // Check if Admin Forced Result for THIS specific moment (simplified check against global var)
            // Ideally this checks a specific DB node for this periodID, but for this scope global override is ok
            if(forcedWingoResult >= 0 && forcedWingoResult <= 9) {
                return forcedWingoResult;
            }
            
            // Mathematical Logic: Sin wave of the Period ID gives a consistent number -1 to 1
            // We multiply by 10000 to get decimals, remove integer part, multiply by 10 to get 0-9
            let seed = periodId;
            let x = Math.sin(seed) * 10000;
            return Math.floor((x - Math.floor(x)) * 10);
        }

        // 2. Prefill History on Load
        function prefillHistory(k, dur) {
            const now = Date.now();
            const currentPeriod = Math.floor(now / 1000 / dur);
            
            // Generate last 15 results instantly
            for(let i=1; i<=15; i++) {
                let p = currentPeriod - i;
                let n = getDeterministicResult(p);
                const size = n>=5?'Big':'Small';
                const color = n==0||n==5?'Violet':(n%2==0?'Red':'Green');
                gameData[k].history.push({ p: p, n, c: color });
            }
            updateWinGoUI();
        }

        // 3. Main Loop
        function runWinGo() {
            setInterval(() => {
                const now = Date.now();
                // We use global timestamp / duration to get a universal Period ID
                updateMarket('30s', 30, now);
                updateMarket('1m', 60, now);
                updateWinGoUI();
            }, 1000);
        }

        function updateMarket(k, dur, timeMs) {
            // Calculate Period based on Epoch Time (Seconds) / Duration
            const currentSeconds = Math.floor(timeMs / 1000);
            const pid = Math.floor(currentSeconds / dur);
            
            // Calculate remaining seconds
            const rem = dur - (currentSeconds % dur);

            // If Period increased, process result
            if(gameData[k].p !== 0 && pid > gameData[k].p) {
                processWinGoResult(k, gameData[k].p); // Process the previous period
            }
            
            gameData[k].p = pid;
            gameData[k].t = rem;
        }

        function processWinGoResult(k, finishedPeriodId) {
            const g = gameData[k];
            
            // Get the synchronized result for the finished period
            const n = getDeterministicResult(finishedPeriodId);

            const size = n>=5?'Big':'Small';
            const color = n==0||n==5?'Violet':(n%2==0?'Red':'Green');

            // Calculate Winnings locally (Only if user bet)
            let win = 0;
            if(g.bets.length > 0) {
                g.bets.forEach(b => {
                    if(b.type==n) win+=b.amt*9;
                    else if(b.type==color||b.type==size) win+=b.amt*1.96;
                });

                if(win > 0) update(ref(db, 'users/'+userId), { balance: wallet + win });
                if(k === mode) triggerResult(win>0?'WIN':'LOSS', win);
            }

            // Update History
            g.history.unshift({ p: finishedPeriodId, n, c: color });
            if(g.history.length>20) g.history.pop();
            g.bets = []; // Clear local bets
        }
        // ==========================================
        // SYNCED WINGO LOGIC END
        // ==========================================

        function updateWinGoUI() {
            const g = gameData[mode];
            const m=Math.floor(g.t/60), s=g.t%60;
            document.getElementById('countdown').innerText = `${m<10?'0'+m:m}:${s<10?'0'+s:s}`;
            document.getElementById('period-num').innerText = g.p;

            const hBody = document.getElementById('history-rows');
            hBody.innerHTML = "";
            g.history.forEach(h => {
                const c = h.c=='Green'?'text-green-600':(h.c=='Red'?'text-red-600':'text-purple-600');
                const size = h.n >= 5 ? 'Big' : 'Small';
                const sizeColor = size === 'Big' ? 'text-orange-600' : 'text-blue-600';
                hBody.innerHTML += `<tr><td class="p-2 text-gray-400">${h.p}</td><td class="p-2 font-black">${h.n}</td><td class="p-2 ${c} font-black">${h.c}</td><td class="p-2 ${sizeColor} font-black uppercase text-[10px]">${size}</td></tr>`;
            });
        }

        // Aviator Logic
        function startAviatorLoop() { resetAviatorRound(); }

        function resetAviatorRound() {
            avState = 'WAITING';
            avMultiplier = 1.00;
            avMyBet = 0;
            updateAviatorUI();
            if(forcedAviatorCrash > 1) {
                avCrashPoint = forcedAviatorCrash;
            } else {
                let r = Math.random();
                if(r < 0.3) avCrashPoint = 1.00 + (Math.random() * 0.2);
                else if (r < 0.8) avCrashPoint = 1.20 + (Math.random() * 2.0);
                else avCrashPoint = 2.00 + (Math.random() * 10.0);
            }
            avCrashPoint = parseFloat(avCrashPoint.toFixed(2));
            setTimeout(() => startFlying(), 5000);
        }

        function startFlying() {
            if(avQueuedBet > 0) {
                if(wallet >= avQueuedBet) {
                    avMyBet = avQueuedBet;
                    update(ref(db, 'users/'+userId), { 
                        balance: wallet - avMyBet,
                        total_wagered: currentTurnover + avMyBet
                    });

                    const betData = {
                        game: 'Aviator',
                        amount: avMyBet,
                        status: 'Flying',
                        time: new Date().toISOString()
                    };
                    push(ref(db, `bets/${userId}`), betData);

                } else {
                    alert("Insufficient balance for Aviator bet!");
                }
                avQueuedBet = 0;
            }
            avState = 'FLYING';
            avInterval = setInterval(() => {
                avMultiplier += 0.01 + (avMultiplier * 0.0008);
                if(avMultiplier >= avCrashPoint) crashAviator();
                updateAviatorUI();
            }, 50);
        }

        function crashAviator() {
            clearInterval(avInterval);
            avState = 'CRASHED';
            avMyBet = 0;
            updateAviatorUI();
            const hist = document.getElementById('aviator-history');
            const clr = avCrashPoint >= 2.0 ? 'text-green-400 border-green-500' : 'text-rose-500 border-rose-500';
            hist.innerHTML = `<div class="min-w-[60px] text-center border rounded-lg p-1 ${clr} font-black text-xs">${avCrashPoint.toFixed(2)}x</div>` + hist.innerHTML;
            setTimeout(() => resetAviatorRound(), 3000);
        }

        function updateAviatorUI() {
            const valEl = document.getElementById('fly-val');
            const btn = document.getElementById('btn-aviator-main');
            const plane = document.getElementById('fly-plane');
            const line = document.getElementById('fly-line');
            const loader = document.getElementById('aviator-loader');
            const crashedText = document.getElementById('crashed-text');

            btn.className = "w-full btn-3d text-white py-5 rounded-2xl text-xl font-black uppercase tracking-widest transition-all";
            btn.disabled = false;

            if(avState === 'WAITING') {
                valEl.innerText = "1.00x";
                plane.style.transform = `translate(0px, 0px)`;
                line.style.width = '0%';
                loader.classList.remove('hidden');
                crashedText.classList.add('hidden');
                if(avQueuedBet > 0) {
                    btn.innerText = "BET PLACED (WAITING)";
                    btn.classList.add('btn-aviator-waiting');
                    btn.disabled = true;
                } else {
                    btn.innerText = "PLACE BET";
                    btn.classList.add('btn-aviator-bet');
                    btn.disabled = false;
                }
            } else if (avState === 'FLYING') {
                loader.classList.add('hidden');
                valEl.innerText = avMultiplier.toFixed(2) + "x";
                const percent = Math.min((avMultiplier - 1) * 20, 90);
                plane.style.transform = `translate(${percent*3}px, -${percent*2}px)`;
                line.style.width = `${percent*3}px`;
                if(avMyBet > 0) {
                    btn.innerText = `CASH OUT ‡ß≥${(avMyBet * avMultiplier).toFixed(2)}`;
                    btn.classList.add('btn-aviator-cashout');
                    btn.disabled = false;
                } else {
                    btn.innerText = "WAIT FOR NEXT ROUND";
                    btn.classList.add('btn-aviator-waiting');
                    btn.disabled = true;
                }
            } else if (avState === 'CRASHED') {
                valEl.innerText = avCrashPoint.toFixed(2) + "x";
                crashedText.classList.remove('hidden');
                if(avQueuedBet > 0) {
                    btn.innerText = "BET PLACED";
                    btn.classList.add('btn-aviator-waiting');
                    btn.disabled = true;
                } else {
                    btn.innerText = "PLACE BET (NEXT)";
                    btn.classList.add('btn-aviator-bet');
                    btn.disabled = false;
                }
            }
        }

        window.handleAviatorMainBtn = () => {
            if(avState === 'FLYING') {
                const win = avMyBet * avMultiplier;
                update(ref(db, 'users/'+userId), { balance: wallet + win });
                triggerResult('WIN', win);
                avMyBet = 0;
                updateAviatorUI();
            } else {
                let amt = parseFloat(document.getElementById('aviator-bet-amt').value);
                if(amt > wallet) { return alert("Low Balance! Please deposit."); }
                if(amt <= 0) return;
                avQueuedBet = amt;
                updateAviatorUI();
            }
        };

        window.adjAvBet = (v) => {
            const input = document.getElementById('aviator-bet-amt');
            let val = parseInt(input.value) + v;
            if(val < 10) val = 10;
            input.value = val;
        };
        window.setAvBet = (v) => document.getElementById('aviator-bet-amt').value = v;

        // --- NEW PROFILE FUNCTIONS ---

        window.openNameModal = () => {
            document.getElementById('nameModal').classList.remove('hidden');
        };

        window.saveUsername = () => {
            const newName = document.getElementById('new-username').value.trim();
            if(!newName) return alert("Name cannot be empty");
            if(newName.length > 15) return alert("Name too long (Max 15 chars)");

            update(ref(db, 'users/' + userId), { username: newName })
                .then(() => {
                    alert("Username Updated!");
                    document.getElementById('nameModal').classList.add('hidden');
                });
        };

        window.openDetailsModal = () => {
            get(ref(db, 'users/' + userId)).then(snap => {
                if(snap.exists()) {
                    const u = snap.val();
                    document.getElementById('detail-uid').innerText = u.uid.slice(0,8).toUpperCase();
                    document.getElementById('detail-email').innerText = u.email;
                    document.getElementById('detail-phone').innerText = u.phone || "N/A";
                    document.getElementById('detail-country').innerText = u.country || "N/A";
                    document.getElementById('detail-join').innerText = u.createdAt ? u.createdAt.split('T')[0] : "N/A";
                    if(u.invitedBy && u.invitedBy !== "NONE") {
                        document.getElementById('detail-ref').innerText = u.invitedBy.slice(0,8).toUpperCase();
                    } else {
                        document.getElementById('detail-ref').innerText = "NONE";
                    }
                    document.getElementById('detailsModal').classList.remove('hidden');
                }
            });
        };

        window.openPasswordModal = () => {
            document.getElementById('passModal').classList.remove('hidden');
        };

        window.changePassword = () => {
            const p1 = document.getElementById('new-pass').value;
            const p2 = document.getElementById('confirm-new-pass').value;

            if(p1.length < 6) return alert("Password must be at least 6 characters");
            if(p1 !== p2) return alert("Passwords do not match");

            const user = auth.currentUser;

            updatePassword(user, p1).then(() => {
                update(ref(db, 'users/' + userId), { password: p1 })
                    .then(() => {
                        alert("Password Changed Successfully! Please Login again.");
                        signOut(auth).then(() => location.reload());
                    });
            }).catch((error) => {
                if(error.code === 'auth/requires-recent-login') {
                    alert("For security, please logout and login again before changing password.");
                } else {
                    alert("Error: " + error.message);
                }
            });
        };
        
        window.openBetHistory = () => {
            const modal = document.getElementById('betHistoryModal');
            const list = document.getElementById('bet-history-list');
            modal.classList.remove('hidden');
            list.innerHTML = '<p class="text-center text-slate-400 mt-10">Loading history...</p>';

            onValue(ref(db, `bets/${userId}`), (snapshot) => {
                list.innerHTML = '';
                if (!snapshot.exists()) {
                    list.innerHTML = '<p class="text-center text-slate-400 mt-10">No bets found.</p>';
                    return;
                }

                const bets = [];
                snapshot.forEach(child => {
                    bets.push(child.val());
                });

                bets.sort((a, b) => new Date(b.time) - new Date(a.time));

                bets.forEach(bet => {
                    const date = new Date(bet.time).toLocaleDateString();
                    const time = new Date(bet.time).toLocaleTimeString();
                    const gameColor = bet.game === 'Win Go' ? 'text-green-600' : 'text-red-500';
                    const icon = bet.game === 'Win Go' ? 'fa-trophy' : 'fa-plane';

                    let detail = '';
                    if(bet.game === 'Win Go') detail = `Bet: <span class="font-black">${bet.type}</span>`;
                    else detail = `Status: ${bet.status || 'Played'}`;

                    list.innerHTML += `
                        <div class="bg-slate-50 p-4 rounded-xl border border-slate-200 flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full bg-white flex items-center justify-center shadow-sm text-slate-500">
                                    <i class="fas ${icon}"></i>
                                </div>
                                <div>
                                    <h4 class="font-black text-xs uppercase ${gameColor}">${bet.game}</h4>
                                    <p class="text-[10px] text-slate-500">${date} at ${time}</p>
                                    <p class="text-[10px] text-slate-600 font-bold mt-1">${detail}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="text-[9px] uppercase font-bold text-slate-400">Amount</p>
                                <p class="text-sm font-black text-slate-800">‡ß≥${parseFloat(bet.amount).toFixed(2)}</p>
                            </div>
                        </div>
                    `;
                });
            }, { onlyOnce: true });
        };

        window.openGiftModal = () => document.getElementById('giftModal').classList.remove('hidden');
        window.redeemCode = () => {
            const codeInput = document.getElementById('gift-code-input');
            const code = codeInput.value.trim().toUpperCase();
            if (!code) { alert("Please enter a code!"); return; }

            get(ref(db, `promocodes/${code}`)).then((snap) => {
                if (!snap.exists()) { alert("Invalid or Expired Code!"); return; }
                const bonusAmount = parseFloat(snap.val());
                get(ref(db, `users/${userId}/used_codes/${code}`)).then((usedSnap) => {
                    if (usedSnap.exists()) { alert("You have already used this code!"); return; }
                    const newBalance = wallet + bonusAmount;
                    const updates = {};
                    updates[`users/${userId}/balance`] = newBalance;
                    updates[`users/${userId}/used_codes/${code}`] = true;
                    update(ref(db), updates).then(() => {
                        alert(`Success! ‡ß≥${bonusAmount} added to your wallet.`);
                        document.getElementById('giftModal').classList.add('hidden');
                        codeInput.value = '';
                    });
                });
            });
        };

        window.openTeamModal = () => {
            document.getElementById('teamModal').classList.remove('hidden');
            const listEl = document.getElementById('team-detail-list');
            listEl.innerHTML = '<p class="text-center text-slate-400 mt-10">Loading...</p>';
            const myRef = ref(db, `users/${userId}/referrals`);
            get(myRef).then(snap => {
                if(!snap.exists()) { listEl.innerHTML = '<p class="text-center text-slate-400 mt-10">No team members yet.</p>'; return; }
                const memberPromises = [];
                snap.forEach(child => {
                    const memberUid = child.key;
                    const p = get(ref(db, `users/${memberUid}`)).then(uSnap => {
                        if(uSnap.exists()) return uSnap.val();
                        return null;
                    });
                    memberPromises.push(p);
                });
                Promise.all(memberPromises).then(members => {
                    listEl.innerHTML = '';
                    let totalDep = 0;
                    members.forEach((m, index) => {
                        if(m) {
                            const dep = parseFloat(m.total_deposit || 0);
                            totalDep += dep;
                            listEl.innerHTML += `<div class="bg-slate-50 p-3 rounded-xl border border-slate-200 flex justify-between items-center"><div><p class="font-black text-xs text-slate-700">UID: ${m.uid.slice(0,8).toUpperCase()}</p><p class="text-[10px] text-slate-400">Join: ${m.createdAt ? m.createdAt.split('T')[0] : 'N/A'}</p></div><div class="text-right"><p class="text-[9px] font-bold text-slate-400 uppercase">Deposit</p><p class="font-black text-green-600">‡ß≥${dep.toFixed(2)}</p></div></div>`;
                        }
                    });
                    const summaryHTML = `<div class="bg-indigo-100 p-4 rounded-xl mb-4 text-center"><p class="text-[10px] font-bold text-indigo-500 uppercase">Total Team Deposit</p><h2 class="2xl font-black text-indigo-700">‡ß≥${totalDep.toFixed(2)}</h2></div>`;
                    listEl.insertAdjacentHTML('afterbegin', summaryHTML);
                });
            });
        };

        window.copyReferral = () => {
            const uid = document.getElementById('ref-uid').innerText;
            if(uid === "LOADING") return;
            navigator.clipboard.writeText(uid).then(() => { alert("Referral Code Copied!"); });
        };

        window.navigateTo = (pageId) => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + pageId).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            const navBtn = document.getElementById('nav-' + pageId);
            if(navBtn) navBtn.classList.add('active');
        };

        window.navigateToPayment = (type) => {
            walletActionType = type;
            document.getElementById('payment-title').innerText = type;
            document.getElementById('deposit-ui').classList.toggle('hidden', type !== 'Deposit');
            document.getElementById('withdraw-ui').classList.toggle('hidden', type !== 'Withdraw');
            navigateTo('payment');
        };

        window.switchMarket = (m) => {
            mode = m;
            document.querySelectorAll('.market-tab').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-'+m).classList.add('active');
            updateWinGoUI();
        };

        window.openBet = (t) => {
            document.getElementById('target').innerText = t;
            document.getElementById('betModal').setAttribute('data-choice', t);
            document.getElementById('betModal').classList.remove('hidden');
        };
        window.closeBet = () => document.getElementById('betModal').classList.add('hidden');
        window.setMoney = (v) => document.getElementById('bet-amt').value = v;

        window.confirmBet = () => {
            let a = parseFloat(document.getElementById('bet-amt').value);
            let t = document.getElementById('betModal').getAttribute('data-choice');

            if(a > wallet) return alert("Low Balance");

            update(ref(db, 'users/'+userId), { 
                balance: wallet - a,
                total_wagered: currentTurnover + a
            });

            const betData = {
                game: 'Win Go',
                type: t,
                amount: a,
                time: new Date().toISOString()
            };
            push(ref(db, `bets/${userId}`), betData);

            gameData[mode].bets.push({ type: t, amt: a });

            closeBet();

            const overlay = document.getElementById('resultOverlay');
            const icon = document.getElementById('resIcon');
            const status = document.getElementById('resStatus');
            const amount = document.getElementById('resAmount');
            const btn = document.getElementById('resBtn');

            icon.innerText = "‚úÖ";
            status.innerText = "SUCCESS";
            status.style.color = '#006a4e';
            amount.innerText = "TRADE SUCCEED";
            amount.classList.add('text-lg', 'text-slate-400', 'font-normal');
            amount.classList.remove('text-xl', 'font-bold', 'text-gray-500');

            btn.innerText = "CONTINUE";

            overlay.style.display = 'flex';
            const resultBox = document.getElementById('resultBox');
            resultBox.classList.remove('result-overlay-animate');
            void resultBox.offsetWidth;
            resultBox.classList.add('result-overlay-animate');
        };

        window.triggerResult = (s, a) => {
            const resBtn = document.getElementById('resBtn');
            resBtn.innerText = "COLLECT";
            resBtn.onclick = closeResult;

            const status = document.getElementById('resStatus');
            status.innerText = s;
            status.style.color = '';

            const amount = document.getElementById('resAmount');
            amount.classList.remove('text-lg', 'text-slate-400', 'font-normal');
            amount.classList.add('text-xl', 'font-bold', 'text-gray-500');

            document.getElementById('resIcon').innerText = s==='WIN'?"üèÜ":"‚ùå";
            document.getElementById('resAmount').innerText = s==='WIN'?"You won ‡ß≥"+a.toFixed(2):"Better luck next time";
            document.getElementById('resultOverlay').style.display = 'flex';
            const resultBox = document.getElementById('resultBox');
            resultBox.classList.remove('result-overlay-animate');
            void resultBox.offsetWidth;
            resultBox.classList.add('result-overlay-animate');
        };

        window.closeResult = () => {
             document.getElementById('resultOverlay').style.display = 'none';
             document.getElementById('resStatus').style.color = '';
        }

        window.showWalletModal = (t) => {
            walletActionType = t;
            document.getElementById('walletModalTitle').innerText = t;
            document.getElementById('deposit-ui').classList.toggle('hidden', t!=='Deposit');
            document.getElementById('withdraw-ui').classList.toggle('hidden', t!=='Withdraw');
            document.getElementById('walletModal').classList.remove('hidden');
        };
        window.closeWalletModal = () => document.getElementById('walletModal').classList.add('hidden');
        window.selectMethod = (m) => {
            selectedMethod = m;
            document.querySelectorAll('[id^="method-"]').forEach(e => e.classList.add('grayscale'));
            document.getElementById('method-'+m).classList.remove('grayscale');
        };

        window.handleWalletAction = () => {
            let amt = parseFloat(document.getElementById('wallet-amt').value);
            if(!amt || amt<=0) return alert("Enter Amount");
            
            if (walletActionType === 'Deposit' && amt < 50) {
                return alert("‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡ß´‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ‡•§");
            }

            if (walletActionType === 'Withdraw') {
                if (amt < 300) {
                    return alert("‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡ß©‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ‡•§");
                }
                
                if(currentTurnover < 500) {
                    return alert("‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶Ü‡¶∞‡ßã " + (500 - currentTurnover).toFixed(2) + " ‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶ó‡ßá‡¶Æ ‡¶ñ‡ßá‡¶≤‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§");
                }
                if(amt > wallet) return alert("Insufficient Balance");
                
                update(ref(db, 'users/'+userId), { balance: wallet - amt });
            }

            const txn = { uid: userId, type: walletActionType, amount: amt, status: 'pending', time: new Date().toISOString() };
            
            push(ref(db, 'transactions'), txn).then(() => {
                navigateTo('wallet');
                
                const overlay = document.getElementById('resultOverlay');
                const icon = document.getElementById('resIcon');
                const status = document.getElementById('resStatus');
                const amount = document.getElementById('resAmount');
                const btn = document.getElementById('resBtn');
                icon.innerText = "‚è≥";
                status.innerText = "PENDING";
                status.style.color = '';
                amount.classList.remove('text-lg', 'text-slate-400', 'font-normal');
                amount.classList.add('text-xl', 'font-bold', 'text-gray-500');
                if(walletActionType === 'Deposit') amount.innerText = "‡¶è‡¶ï ‡¶•‡ßá‡¶ï‡ßá ‡¶¶‡ßÅ‡¶á ‡¶ò‡¶£‡ßç‡¶ü‡¶æ ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ï‡¶∞‡¶õ‡¶ø‡•§";
                else amount.innerText = "‡¶è‡¶ï ‡¶•‡ßá‡¶ï‡ßá ‡¶¶‡ßÅ‡¶á ‡¶ò‡¶®‡ßç‡¶ü‡¶æ ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶á‡¶°‡ßç‡¶∞ ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ï‡¶∞‡¶õ‡¶ø‡•§";
                btn.innerText = "OKAY";
                btn.onclick = closeResult;
                overlay.style.display = 'flex';
                const resultBox = document.getElementById('resultBox');
                resultBox.classList.remove('result-overlay-animate');
                void resultBox.offsetWidth;
                resultBox.classList.add('result-overlay-animate');
            });
        };
    </script>
</body>
</html>